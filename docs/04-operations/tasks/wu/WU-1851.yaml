id: WU-1851
title: Centralize MCP surface CLI command/flag/metadata-key governance with guardrail ratchet
lane: 'Framework: Core Lifecycle'
type: refactor
status: ready
priority: P2
created: 2026-02-18
code_paths:
  - packages/@lumenflow/mcp/src/tools-shared.ts
  - packages/@lumenflow/mcp/src/tools/parity-tools.ts
  - packages/@lumenflow/mcp/src/tools/wu-tools.ts
  - packages/@lumenflow/mcp/src/tools/setup-tools.ts
  - packages/@lumenflow/mcp/src/tools/validation-tools.ts
  - packages/@lumenflow/mcp/src/tools/initiative-tools.ts
  - packages/@lumenflow/mcp/src/tools/orchestration-tools.ts
  - packages/@lumenflow/mcp/src/tools/agent-tools.ts
  - packages/@lumenflow/mcp/src/tools/memory-tools.ts
  - packages/@lumenflow/mcp/src/tools/context-tools.ts
  - packages/@lumenflow/mcp/src/tools/flow-tools.ts
tests:
  manual:
    - Verify core MCP flows execute with unchanged behavior
  unit:
    - packages/@lumenflow/mcp/src/__tests__/tools.test.ts
    - packages/@lumenflow/mcp/src/__tests__/wu-tools.test.ts
    - packages/@lumenflow/mcp/src/__tests__/literal-governance.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1851.done
dependencies: []
initiative: INIT-030
phase: 3
blocked_by:
  - WU-1848
spec_refs:
  - /home/tom/.claude/plans/adaptive-finding-adleman.md,/home/tom/.claude/plans/zesty-jumping-pixel.md
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: 'Context: following WU-1848 (kernel identifier governance), the MCP tool surface still contains 150+ raw string literals across 12 tool modules. Problem: with INIT-030 Phase 3 adding 90 new tool handlers, literal drift will compound. Solution: typed MCP constant modules for governed families and a grep-based guardrail ratchet test.'
acceptance:
  - Introduce mcp-constants.ts with typed constant groups for CLI command names, shared CLI flag tokens (flags in 3+ tool definitions), and cross-boundary metadata keys.
  - All touched MCP tool files import shared constants for governed families. Flags in fewer than 3 tools remain local.
  - literal-governance.test.ts implements grep-based guardrail ratchet with allowlist that fails on new duplicate governance literals.
  - No changes to the public API surface of @lumenflow/mcp exports.
  - pnpm gates passes.
