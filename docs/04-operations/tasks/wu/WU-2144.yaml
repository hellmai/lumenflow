id: WU-2144
title: wu:brief writes checkpoint event to wu-events.jsonl when run outside worktree
lane: 'Framework: CLI WU Commands'
type: bug
status: ready
priority: P2
created: 2026-02-25
code_paths:
  - packages/@lumenflow/cli/src/wu-spawn-strategy-resolver.ts
tests:
  manual:
    - Run wu:brief from main checkout and verify wu-events.jsonl is unchanged
    - Run wu:brief from a worktree and verify checkpoint event is written
  unit:
    - packages/@lumenflow/cli/__tests__/wu-spawn-strategy-resolver.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2144.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: wu:brief calls recordWuBriefEvidence() which writes a checkpoint event to .lumenflow/state/wu-events.jsonl regardless of context. When run from main checkout (e.g. orchestrator generating briefs), this mutates shared state before the WU is even claimed. The evidence recording should be gated on being inside a worktree, or deferred until wu:claim.
acceptance:
  - recordWuBriefEvidence skips writing when not in a worktree context
  - Running wu:brief from main checkout does not modify wu-events.jsonl
  - Running wu:brief from a worktree still records evidence as before
