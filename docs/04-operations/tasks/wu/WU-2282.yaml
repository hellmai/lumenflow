id: WU-2282
title: Scope wu:done checkpoint writes to worktree instead of main
lane: 'Framework: CLI WU Commands'
type: bug
status: ready
priority: P1
created: 2026-03-01
code_paths:
  - packages/@lumenflow/cli/src/wu-done.ts
  - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
tests:
  manual:
    - Run wu:prep/wu:done workflow and verify main remains clean of checkpoint files
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-done.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2282.done
dependencies: []
risks: []
notes: 'Root cause: wu:done calls markGatesPassed(id) and clearCheckpoint(id) without options, defaulting to process.cwd().'
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Fix wu:done checkpoint helper calls so mark/clear operations use worktree baseDir, preventing checkpoint files from being created or deleted in main checkout.
acceptance:
  - wu:done passes baseDir when calling markGatesPassed and clearCheckpoint
  - Add or update tests to cover scoped checkpoint behavior
  - No checkpoint artifact appears on main from this path
