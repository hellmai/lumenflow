id: WU-2279
title: Fix state:doctor --fix invalid temp branch name
lane: 'Framework: CLI Memory State'
type: bug
status: ready
priority: P1
created: 2026-02-28
code_paths:
  - packages/@lumenflow/cli/src/state-doctor.ts
  - packages/@lumenflow/cli/src/__tests__/state-doctor.test.ts
tests:
  manual:
    - 'Run: pnpm state:doctor --fix in a workspace with initiative status mismatches; verify no invalid branch name error'
  unit:
    - packages/@lumenflow/cli/src/__tests__/state-doctor.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2279.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "Context: state:doctor --fix initiative status reconciliation uses micro-worktree operation name 'state:doctor'. Problem: colon in operation name generates temp branch ref tmp/state:doctor/... which git rejects as invalid, so auto-fix fails. Solution: use a branch-safe operation identifier for this path and add regression coverage."
acceptance:
  - pnpm state:doctor --fix no longer fails with invalid branch-name errors for tmp/state:doctor/*
  - initiative lifecycle status fixes run through micro-worktree path successfully when mismatches are fixable
  - state-doctor regression test asserts branch-safe micro-worktree operation usage
