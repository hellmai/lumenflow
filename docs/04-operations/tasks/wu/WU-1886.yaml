id: WU-1886
title: Add executeViaPack migration compat guard and fallback telemetry
lane: 'Framework: Core Lifecycle'
type: bug
status: ready
priority: P0
created: 2026-02-19
code_paths:
  - packages/@lumenflow/mcp/src/tools-shared.ts
  - packages/@lumenflow/mcp/src/mcp-constants.ts
  - packages/@lumenflow/mcp/src/__tests__/tools-shared.test.ts
tests:
  manual:
    - Run MCP command path with guard on/off and verify fallback behavior and telemetry
  unit:
    - packages/@lumenflow/mcp/src/__tests__/tools-shared.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1886.done
dependencies: []
initiative: INIT-031
phase: 6
blocked_by:
  - WU-1884
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Runtime-first routing currently needs a controlled migration mode so partially migrated software-delivery commands can continue operating while handlers are moved from CLI fallback to native pack execution. This WU introduces an explicit compatibility guard and structured telemetry around fallback decisions to make temporary fallback visible, auditable, and easy to disable.
acceptance:
  - A dedicated migration fallback error code is supported only when migration compatibility guard is enabled
  - Fallback events include structured telemetry fields needed for migration observability (tool name, reason, workspace root)
  - Strict mode disables migration fallback path and returns explicit failure for unmigrated handlers
