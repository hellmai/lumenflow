id: WU-1612
title: PostToolUse hook to track agent launches for compaction recovery
lane: 'Framework: CLI Enforcement'
type: feature
status: ready
priority: P2
created: 2026-02-12
code_paths:
  - .claude/hooks/pre-compact-checkpoint.sh
  - .claude/settings.json
tests:
  manual:
    - '(auto) Manual check: verify acceptance criteria; add automated tests before changing code files.'
  unit: []
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1612.done
dependencies: []
spec_refs:
  - lumenflow://conversation/agent-compaction-recovery
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: Add a PostToolUse hook on Task tool that writes a mem:signal recording each agent launch (ID, description, subagent type). The existing PreCompact and SessionStart hooks already surface signals in recovery context, so this single hook closes the gap where compacted agents forget their running sub-agents.
acceptance:
  - PostToolUse hook fires on Task tool calls and records agent ID + description via mem:signal
  - After compaction, recovery context includes active agent IDs from signals
  - No new state files â€” uses existing signal bus
  - Hook is informational only (exit 0, never blocks)
