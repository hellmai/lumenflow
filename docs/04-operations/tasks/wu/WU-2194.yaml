id: WU-2194
title: Remove redundant ensureMainUpToDate pre-flight checks from micro-worktree commands
lane: 'Framework: CLI WU Commands'
type: refactor
status: ready
priority: P2
created: 2026-02-26
code_paths:
  - packages/@lumenflow/cli/src/wu-claim.ts
  - packages/@lumenflow/cli/src/wu-edit.ts
  - packages/@lumenflow/cli/src/wu-delete.ts
tests:
  manual:
    - Claim 3 WUs in rapid succession without git pull between them — all succeed
  unit:
    - packages/@lumenflow/cli/src/__tests__/wu-claim-no-preflight-sync.test.ts
    - packages/@lumenflow/cli/src/__tests__/wu-edit-no-preflight-sync.test.ts
    - packages/@lumenflow/cli/src/__tests__/wu-delete-no-preflight-sync.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-2194.done
dependencies: []
risks: []
notes: (auto) Add implementation notes, rollout context, or a short summary of the plan/conversation.
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "wu:claim, wu:edit (ready path), and wu:delete all call ensureMainUpToDate() as a pre-flight check before entering withMicroWorktree/pushOnly mode. This is redundant because: (1) pushOnly mode (wu:claim) bases from origin/main, not local main, (2) standard withMicroWorktree (wu:edit, wu:delete) auto-syncs local main via ff-merge internally. initiative:edit already removed this check in WU-1497 with the comment 'withMicroWorktree already handles origin sync'. The pre-flight check creates serial friction for multi-agent orchestration — each wu:claim pushes to origin, putting the next claim's local main out of sync, requiring manual git pull between claims."
acceptance:
  - ensureMainUpToDate pre-flight call removed from wu-claim.ts
  - ensureMainUpToDate pre-flight call removed from wu-edit.ts ready-WU path
  - ensureMainUpToDate pre-flight call removed from wu-delete.ts (single and batch)
  - Regression tests assert ensureMainUpToDate is NOT called (following initiative-edit.test.ts pattern from WU-1497)
  - wu:done retains both ensureMainUpToDate and ensureMainNotBehindOrigin checks (justified — real merge)
  - All existing tests pass
