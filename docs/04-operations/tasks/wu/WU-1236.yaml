id: WU-1236
title: Add mem:search command with BM25 and LLM rerank prompt
lane: 'Framework: Memory'
type: feature
status: ready
priority: P2
created: 2026-01-30
code_paths:
  - packages/@lumenflow/memory/src/mem-search-core.ts
  - packages/@lumenflow/cli/src/mem-search.ts
  - packages/@lumenflow/memory/src/search/bm25.ts
  - packages/@lumenflow/memory/src/search/filters.ts
tests:
  manual: []
  unit:
    - packages/@lumenflow/memory/src/__tests__/mem-search-core.test.ts
    - packages/@lumenflow/memory/src/__tests__/bm25.test.ts
    - packages/@lumenflow/cli/__tests__/mem-search.test.ts
  e2e: []
artifacts:
  - .lumenflow/stamps/WU-1236.done
dependencies: []
risks: []
notes: ''
requires_review: false
assigned_to: tom@hellm.ai
exposure: backend-only
escalation_triggers: []
requires_human_escalation: false
requires_cso_approval: false
requires_cto_approval: false
requires_design_approval: false
description: "Context: Current memory layer only supports queryByWu() - exact ID match. There is no way to search memories by content or find semantically related information. Problem: Agents cannot find relevant context without knowing exact WU IDs. Questions like 'what did we decide about auth?' have no answer mechanism. Solution: Add mem:search command with BM25 keyword search + metadata filters, plus an optional LLM rerank prompt for the host agent to run semantic selection. Technical approach (vendor-agnostic, no embedding providers): (1) Candidate retrieval via BM25 (TF-IDF variant, uses natural package - established 12+ years), (2) Metadata filters: --wu, --lifecycle, --tags, --type, --since, (3) Results ranked by BM25 score + recency boost, (4) Optional --rerank flag outputs LLM-ready prompt block for semantic reranking, (5) Host agent (Claude/GPT) runs rerank prompt and returns top picks. This achieves LLM-first semantic retrieval without requiring an embedding provider layer."
acceptance:
  - mem:search <query> returns BM25-ranked memory nodes
  - 'Filters supported: --wu, --lifecycle, --tags, --type, --since, --until'
  - --limit N restricts result count (default 10)
  - Results include BM25 score and basic metadata
  - --rerank flag outputs LLM prompt block for semantic reranking
  - Rerank prompt includes candidate summaries and selection instructions
  - Empty result set handled gracefully with helpful message
  - BM25 implementation uses natural package (established, 12+ years)
  - Unit tests cover BM25 scoring, filtering, and output formatting
  - Documentation updated in memory package README
